#!/bin/bash
# info: restore web server ports to default (80/443)
# options: NONE
#
# example: v-restore-sys-web-port
#
# This function restores Nginx/Apache ports back to 80/443 after removing HAProxy.

#----------------------------------------------------------#
#                Variables & Functions                     #
#----------------------------------------------------------#

# Includes
source /etc/vhestia/hestia.conf
source $HESTIA/func/main.sh
source_conf "$HESTIA/conf/hestia.conf"

#----------------------------------------------------------#
#                    Verifications                         #
#----------------------------------------------------------#

if [ "$(id -u)" != "0" ]; then
    echo "Error: This script must be run as root"
    exit 1
fi

# Check current ports
current_web_port=$(grep "^WEB_PORT=" $HESTIA/conf/hestia.conf 2>/dev/null | cut -d"'" -f2)
current_ssl_port=$(grep "^WEB_SSL_PORT=" $HESTIA/conf/hestia.conf 2>/dev/null | cut -d"'" -f2)

if [ "$current_web_port" = "80" ] && [ "$current_ssl_port" = "443" ]; then
    echo "Web ports are already at default (80/443)"
    exit 0
fi

#----------------------------------------------------------#
#                       Action                             #
#----------------------------------------------------------#

echo "Restoring web server ports to default..."
echo "  HTTP:  ${current_web_port:-8080} → 80"
echo "  HTTPS: ${current_ssl_port:-8443} → 443"

# Use the change port script to restore
$HESTIA/bin/v-change-sys-web-port 80 443

#----------------------------------------------------------#
#                       Result                             #
#----------------------------------------------------------#

echo ""
echo "Web server ports restored to 80/443"

exit 0
