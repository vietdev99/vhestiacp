<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Install | VHestiaCP</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a25;
            --bg-card: #15151f;
            --border-color: #2a2a3a;
            --border-hover: #3a3a50;
            --text-primary: #f0f0f5;
            --text-secondary: #a0a0b5;
            --text-muted: #606080;
            --accent-primary: #6366f1;
            --accent-secondary: #8b5cf6;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gradient-primary: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 14px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
        }

        .bg-pattern {
            position: fixed;
            inset: 0;
            background:
                radial-gradient(ellipse 80% 50% at 50% -20%, rgba(99, 102, 241, 0.12), transparent),
                radial-gradient(ellipse 60% 40% at 100% 0%, rgba(139, 92, 246, 0.08), transparent);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 16px;
            position: relative;
            z-index: 1;
        }

        /* Compact Header */
        header {
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
            background: rgba(10, 10, 15, 0.9);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: var(--gradient-primary);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 16px;
            color: white;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .version-badge {
            font-size: 11px;
            padding: 3px 8px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .reset-btn {
            padding: 6px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .reset-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        /* Main Layout - 3 columns */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr 380px;
            gap: 16px;
            padding: 16px 0;
            min-height: calc(100vh - 70px);
        }

        @media (max-width: 1400px) {
            .main-layout {
                grid-template-columns: 1fr 1fr;
            }
            .output-panel {
                grid-column: span 2;
            }
        }

        @media (max-width: 900px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            .output-panel {
                grid-column: span 1;
            }
        }

        /* Options Columns */
        .options-column {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* Compact Option Group */
        .option-group {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .group-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            user-select: none;
        }

        .group-header:hover {
            background: var(--bg-tertiary);
        }

        .group-icon {
            width: 26px;
            height: 26px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            flex-shrink: 0;
        }

        .group-icon.purple { background: rgba(139, 92, 246, 0.15); color: #a78bfa; }
        .group-icon.blue { background: rgba(59, 130, 246, 0.15); color: #60a5fa; }
        .group-icon.green { background: rgba(34, 197, 94, 0.15); color: #4ade80; }
        .group-icon.orange { background: rgba(245, 158, 11, 0.15); color: #fbbf24; }
        .group-icon.red { background: rgba(239, 68, 68, 0.15); color: #f87171; }
        .group-icon.cyan { background: rgba(6, 182, 212, 0.15); color: #22d3ee; }
        .group-icon.pink { background: rgba(236, 72, 153, 0.15); color: #f472b6; }
        .group-icon.indigo { background: rgba(99, 102, 241, 0.15); color: #818cf8; }

        .group-title {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            flex: 1;
        }

        .group-badge {
            padding: 2px 6px;
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
            border-radius: 4px;
            background: rgba(34, 197, 94, 0.15);
            color: #4ade80;
        }

        .collapse-icon {
            color: var(--text-muted);
            font-size: 10px;
            transition: transform 0.2s;
        }

        .option-group.collapsed .collapse-icon {
            transform: rotate(-90deg);
        }

        .option-group.collapsed .group-content {
            display: none;
        }

        .group-content {
            padding: 8px;
        }

        /* Compact Option Item */
        .option-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 10px;
            background: var(--bg-secondary);
            border: 1px solid transparent;
            border-radius: var(--radius-sm);
            margin-bottom: 4px;
            transition: all 0.15s;
        }

        .option-item:last-child {
            margin-bottom: 0;
        }

        .option-item:hover {
            border-color: var(--border-color);
            background: var(--bg-tertiary);
        }

        .option-item.highlight {
            border-left: 2px solid var(--accent-primary);
        }

        .option-item.disabled {
            opacity: 0.4;
            pointer-events: none;
        }

        .option-info {
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 0;
            flex: 1;
        }

        .option-name {
            font-weight: 600;
            font-size: 13px;
            white-space: nowrap;
        }

        .option-desc {
            font-size: 11px;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Compact Toggle */
        .toggle-switch {
            position: relative;
            width: 36px;
            height: 20px;
            flex-shrink: 0;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            transition: all 0.2s;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 14px;
            width: 14px;
            left: 2px;
            bottom: 2px;
            background: var(--text-muted);
            border-radius: 50%;
            transition: all 0.2s;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(16px);
            background: white;
        }

        /* Compact Input */
        .input-field {
            width: 140px;
            padding: 5px 8px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .input-field.small {
            width: 70px;
        }

        .select-field {
            padding: 5px 24px 5px 8px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 24 24' fill='none' stroke='%23606080' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 6px center;
        }

        .select-field:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        /* Sub Options */
        .sub-options {
            margin-top: 6px;
            padding: 8px;
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-color);
        }

        .sub-options.hidden {
            display: none;
        }

        .sub-label {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 6px;
        }

        /* Checkbox Group */
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 11px;
            font-weight: 500;
        }

        .checkbox-item:hover {
            border-color: var(--border-hover);
        }

        .checkbox-item.checked {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .checkbox-item input { display: none; }

        .checkbox-item .checkmark {
            width: 12px;
            height: 12px;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
        }

        .checkbox-item.checked .checkmark {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .checkbox-item.checked .checkmark::after {
            content: "✓";
        }

        /* Output Panel - Sticky */
        .output-panel {
            position: sticky;
            top: 70px;
            height: fit-content;
            max-height: calc(100vh - 90px);
            overflow-y: auto;
        }

        .output-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .output-header {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
        }

        .output-header h3 {
            font-size: 13px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 10px;
        }

        .output-steps {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .step {
            display: flex;
            gap: 8px;
            align-items: flex-start;
        }

        .step-number {
            width: 20px;
            height: 20px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
            color: var(--text-secondary);
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
            min-width: 0;
        }

        .step-content p {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .step-code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            padding: 6px 8px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--accent-secondary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .step-code code {
            overflow-x: auto;
            white-space: nowrap;
        }

        .copy-btn {
            padding: 2px 6px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 3px;
            color: var(--text-muted);
            font-size: 9px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .copy-btn:hover {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .copy-btn.copied {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        /* Command Output */
        .command-output {
            padding: 12px;
        }

        .command-label {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .command-box {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            overflow: hidden;
        }

        .command-box-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 10px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
        }

        .command-box-header span {
            font-size: 10px;
            color: var(--text-muted);
        }

        .command-content {
            padding: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            line-height: 1.6;
            color: var(--text-primary);
            max-height: 200px;
            overflow-y: auto;
            word-break: break-all;
        }

        .cmd-flag { color: var(--accent-secondary); }
        .cmd-value { color: var(--success); }

        /* Summary Stats */
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            padding: 12px;
            border-top: 1px solid var(--border-color);
            background: var(--bg-secondary);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            font-size: 9px;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        /* Info note */
        .info-note {
            padding: 6px 8px;
            background: rgba(245, 158, 11, 0.1);
            border-left: 2px solid var(--warning);
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
            font-size: 10px;
            color: var(--text-secondary);
        }

        .info-note strong {
            color: var(--warning);
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 2px; }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>

    <header>
        <div class="container">
            <div class="header-content">
                <a href="#" class="logo">
                    <div class="logo-icon">V</div>
                    <span class="logo-text">VHestiaCP Installer</span>
                </a>
                <div class="header-right">
                    <span class="version-badge">v1.0.0</span>
                    <button class="reset-btn" onclick="resetOptions()">Reset</button>
                </div>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <div class="main-layout">
                <!-- Column 1: General, Web, Runtime -->
                <div class="options-column">
                    <!-- General Settings -->
                    <div class="option-group">
                        <div class="group-header" onclick="toggleGroup(this)">
                            <div class="group-icon purple">&#9881;</div>
                            <span class="group-title">General</span>
                            <span class="collapse-icon">&#9660;</span>
                        </div>
                        <div class="group-content">
                            <div class="option-item">
                                <div class="option-info">
                                    <span class="option-name">Hostname</span>
                                </div>
                                <input type="text" class="input-field" id="hostname" placeholder="auto-detect" oninput="generateCommand()">
                            </div>
                            <div class="option-item">
                                <div class="option-info">
                                    <span class="option-name">Email</span>
                                </div>
                                <input type="email" class="input-field" id="email" placeholder="admin@example.com" oninput="generateCommand()">
                            </div>
                            <div class="option-item">
                                <div class="option-info">
                                    <span class="option-name">Password</span>
                                </div>
                                <input type="password" class="input-field" id="password" placeholder="auto-generate" oninput="generateCommand()">
                            </div>
                            <!-- Port is hidden, always 8083 -->
                            <input type="hidden" id="port" value="8083">
                            <div class="option-item">
                                <div class="option-info">
                                    <span class="option-name">Language</span>
                                </div>
                                <select class="select-field" id="lang" onchange="generateCommand()">
                                    <option value="en">English</option>
                                    <option value="vi">Tiếng Việt</option>
                                    <option value="zh-cn">中文</option>
                                    <option value="ja">日本語</option>
                                    <option value="de">Deutsch</option>
                                    <option value="fr">Français</option>
                                    <option value="ru">Русский</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Web Stack -->
                    <div class="option-group">
                        <div class="group-header" onclick="toggleGroup(this)">
                            <div class="group-icon blue">&#127760;</div>
                            <span class="group-title">Web Server</span>
                            <span class="collapse-icon">&#9660;</span>
                        </div>
                        <div class="group-content">
                            <div class="option-item">
                                <div class="option-info">
                                    <span class="option-name">Web Stack</span>
                                </div>
                                <select class="select-field" id="web-stack" onchange="updateWebStack()">
                                    <option value="haproxy-nginx">HAProxy + Nginx</option>
                                    <option value="haproxy-apache">HAProxy + Apache</option>
                                    <option value="nginx-apache">Nginx + Apache</option>
                                    <option value="nginx-only">Nginx Only</option>
                                    <option value="apache-only">Apache Only</option>
                                    <option value="no-web">None</option>
                                </select>
                            </div>
                            <div class="option-item">
                                <div class="option-info">
                                    <span class="option-name">PHP-FPM</span>
                                    <span class="option-desc">Optional - for PHP websites</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="phpfpm" onchange="generateCommand()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="sub-options" id="haproxy-options">
                                <div class="sub-label">HAProxy Options</div>
                                <div class="option-item">
                                    <span class="option-name">Stats Dashboard</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="haproxy-stats" checked onchange="generateCommand()">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="info-note">
                                <strong>Multi-PHP</strong> can be installed later from Control Panel
                            </div>
                        </div>
                    </div>

                    <!-- Node.js & Python -->
                    <div class="option-group">
                        <div class="group-header" onclick="toggleGroup(this)">
                            <div class="group-icon green">&#128640;</div>
                            <span class="group-title">Runtime</span>
                            <span class="group-badge">NEW</span>
                            <span class="collapse-icon">&#9660;</span>
                        </div>
                        <div class="group-content">
                            <div class="option-item highlight">
                                <div class="option-info">
                                    <span class="option-name">Node.js + PM2</span>
                                    <span class="option-desc">Required for VHestiaCP Panel</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="nodejs" checked disabled>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="sub-options" id="nodejs-options">
                                <div class="sub-label">Node.js Versions</div>
                                <div class="checkbox-group" id="nodejs-versions">
                                    <label class="checkbox-item" onclick="toggleCheckbox(this)">
                                        <input type="checkbox" value="18"><span class="checkmark"></span><span>18</span>
                                    </label>
                                    <label class="checkbox-item checked" onclick="toggleCheckbox(this)">
                                        <input type="checkbox" value="20" checked><span class="checkmark"></span><span>20</span>
                                    </label>
                                    <label class="checkbox-item" onclick="toggleCheckbox(this)">
                                        <input type="checkbox" value="22"><span class="checkmark"></span><span>22</span>
                                    </label>
                                </div>
                            </div>
                            <div class="option-item highlight">
                                <div class="option-info">
                                    <span class="option-name">Python + Gunicorn</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="python" onchange="togglePython()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="sub-options hidden" id="python-options">
                                <div class="sub-label">Python Versions</div>
                                <div class="checkbox-group" id="python-versions">
                                    <label class="checkbox-item" onclick="toggleCheckbox(this)">
                                        <input type="checkbox" value="3.10"><span class="checkmark"></span><span>3.10</span>
                                    </label>
                                    <label class="checkbox-item checked" onclick="toggleCheckbox(this)">
                                        <input type="checkbox" value="3.11" checked><span class="checkmark"></span><span>3.11</span>
                                    </label>
                                    <label class="checkbox-item" onclick="toggleCheckbox(this)">
                                        <input type="checkbox" value="3.12"><span class="checkmark"></span><span>3.12</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DNS & Mail -->
                    <div class="option-group">
                        <div class="group-header" onclick="toggleGroup(this)">
                            <div class="group-icon indigo">&#128231;</div>
                            <span class="group-title">DNS & Mail</span>
                            <span class="collapse-icon">&#9660;</span>
                        </div>
                        <div class="group-content">
                            <div class="option-item">
                                <span class="option-name">BIND DNS</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="named" checked onchange="generateCommand()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="option-item">
                                <span class="option-name">Exim (SMTP)</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="exim" checked onchange="toggleExim()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="option-item" id="dovecot-option">
                                <span class="option-name">Dovecot (IMAP)</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="dovecot" checked onchange="generateCommand()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="option-item" id="sieve-option">
                                <span class="option-name">Sieve Filter</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="sieve" onchange="generateCommand()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="option-item" id="clamav-option">
                                <span class="option-name">ClamAV</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="clamav" checked onchange="generateCommand()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="option-item" id="spamassassin-option">
                                <span class="option-name">SpamAssassin</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="spamassassin" checked onchange="generateCommand()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Column 2: Databases, Security -->
                <div class="options-column">
                    <!-- Databases -->
                    <div class="option-group">
                        <div class="group-header" onclick="toggleGroup(this)">
                            <div class="group-icon pink">&#128451;</div>
                            <span class="group-title">Databases</span>
                            <span class="collapse-icon">&#9660;</span>
                        </div>
                        <div class="group-content">
                            <div class="option-item">
                                <span class="option-name">MariaDB</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="mysql" checked onchange="toggleMysql()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <!-- MySQL 8 temporarily disabled - will be developed later -->
                            <div class="option-item disabled" style="display: none;">
                                <span class="option-name">MySQL 8 (instead)</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="mysql8" disabled>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="option-item">
                                <span class="option-name">PostgreSQL</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="postgresql" onchange="generateCommand()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="option-item highlight">
                                <span class="option-name">MongoDB</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="mongodb" onchange="toggleMongodb()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="sub-options hidden" id="mongodb-options">
                                <div class="sub-label">MongoDB Options</div>
                                <div class="option-item">
                                    <span class="option-name">Version</span>
                                    <select class="select-field" id="mongodb-version" onchange="updateMongodbWarning(); generateCommand()">
                                        <option value="8.0">8.0</option>
                                        <option value="7.0">7.0 (Ubuntu ≤22.04)</option>
                                        <option value="6.0">6.0 (Ubuntu ≤22.04)</option>
                                    </select>
                                </div>
                                <div class="info-note" id="mongodb-warning" style="display:none;">
                                    <strong>Warning:</strong> MongoDB &lt; 7.0 is not compatible with Ubuntu 24.04. Version 7.0+ will be used instead.
                                </div>
                                <div class="option-item">
                                    <span class="option-name">Mongo Express</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="mongo-express" onchange="generateCommand()">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Message Queue -->
                    <div class="option-group">
                        <div class="group-header" onclick="toggleGroup(this)">
                            <div class="group-icon orange">&#128232;</div>
                            <span class="group-title">Message Queue</span>
                            <span class="group-badge">NEW</span>
                            <span class="collapse-icon">&#9660;</span>
                        </div>
                        <div class="group-content">
                            <div class="option-item highlight">
                                <span class="option-name">RabbitMQ</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="rabbitmq" onchange="toggleRabbitmq()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="sub-options hidden" id="rabbitmq-options">
                                <div class="option-item">
                                    <span class="option-name">Management UI</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="rabbitmq-management" checked onchange="generateCommand()">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="option-item highlight">
                                <span class="option-name">Apache Kafka</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="kafka" onchange="toggleKafka()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="sub-options hidden" id="kafka-options">
                                <div class="option-item">
                                    <span class="option-name">Kafka UI</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="kafka-ui" checked onchange="generateCommand()">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="option-item highlight">
                                <span class="option-name">Redis</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="redis" onchange="generateCommand()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Security & FTP -->
                    <div class="option-group">
                        <div class="group-header" onclick="toggleGroup(this)">
                            <div class="group-icon red">&#128274;</div>
                            <span class="group-title">Security & FTP</span>
                            <span class="collapse-icon">&#9660;</span>
                        </div>
                        <div class="group-content">
                            <div class="option-item">
                                <span class="option-name">Firewall (iptables)</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="iptables" checked onchange="generateCommand()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="option-item">
                                <span class="option-name">Fail2Ban</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="fail2ban" checked onchange="generateCommand()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="option-item">
                                <span class="option-name">FTP Server</span>
                                <select class="select-field" id="ftp" onchange="generateCommand()">
                                    <option value="vsftpd">VSFTPD</option>
                                    <option value="proftpd">ProFTPD</option>
                                    <option value="none">None</option>
                                </select>
                            </div>
                            <div class="option-item">
                                <span class="option-name">Disk Quota</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="quota" onchange="generateCommand()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Advanced -->
                    <div class="option-group">
                        <div class="group-header" onclick="toggleGroup(this)">
                            <div class="group-icon purple">&#128736;</div>
                            <span class="group-title">Advanced</span>
                            <span class="collapse-icon">&#9660;</span>
                        </div>
                        <div class="group-content">
                            <!-- Hestia API hidden - always disabled for VHestiaCP -->
                            <input type="hidden" id="api" value="">
                            <div class="option-item">
                                <span class="option-name">Interactive</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="interactive" onchange="generateCommand()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Column 3: Output -->
                <div class="output-panel">
                    <div class="output-card">
                        <div class="output-header">
                            <h3>&#128640; Quick Start</h3>
                            <div class="output-steps">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <p>Connect via SSH:</p>
                                        <div class="step-code">
                                            <code>ssh root@your-server</code>
                                            <button class="copy-btn" onclick="copyToClipboard('ssh root@your-server', this)">Copy</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <p>Clone & enter directory:</p>
                                        <div class="step-code">
                                            <code>git clone https://github.com/vietdev99/vhestiacp.git && cd vhestiacp/install</code>
                                            <button class="copy-btn" onclick="copyToClipboard('git clone https://github.com/vietdev99/vhestiacp.git && cd vhestiacp/install', this)">Copy</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="step">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <p>Run install command:</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="command-output">
                            <div class="command-label">Generated Command</div>
                            <div class="command-box">
                                <div class="command-box-header">
                                    <span>bash</span>
                                    <button class="copy-btn" onclick="copyCommand()">Copy</button>
                                </div>
                                <div class="command-content" id="command-output"></div>
                            </div>
                        </div>
                        <div class="summary-stats">
                            <div class="stat-item">
                                <div class="stat-value" id="stat-services">0</div>
                                <div class="stat-label">Services</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="stat-new">0</div>
                                <div class="stat-label">New</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="stat-time">~15</div>
                                <div class="stat-label">Minutes</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            generateCommand();
            updateWebStack();
        });

        function toggleGroup(header) {
            header.parentElement.classList.toggle('collapsed');
        }

        function generateCommand() {
            const hostname = document.getElementById('hostname').value || '';
            const email = document.getElementById('email').value || 'admin@example.com';
            const password = document.getElementById('password').value;
            const port = document.getElementById('port').value || '8083';
            const lang = document.getElementById('lang').value;
            const webStack = document.getElementById('web-stack').value;
            const phpfpm = document.getElementById('phpfpm').checked;
            const haproxyStats = document.getElementById('haproxy-stats').checked;
            const nodejs = document.getElementById('nodejs').checked;
            const python = document.getElementById('python').checked;
            const mysql = document.getElementById('mysql').checked;
            const mysql8 = document.getElementById('mysql8').checked;
            const postgresql = document.getElementById('postgresql').checked;
            const mongodb = document.getElementById('mongodb').checked;
            const mongodbVersion = document.getElementById('mongodb-version').value;
            const rabbitmq = document.getElementById('rabbitmq').checked;
            const kafka = document.getElementById('kafka').checked;
            const redis = document.getElementById('redis').checked;
            const named = document.getElementById('named').checked;
            const exim = document.getElementById('exim').checked;
            const dovecot = document.getElementById('dovecot').checked;
            const sieve = document.getElementById('sieve').checked;
            const clamav = document.getElementById('clamav').checked;
            const spamassassin = document.getElementById('spamassassin').checked;
            const iptables = document.getElementById('iptables').checked;
            const fail2ban = document.getElementById('fail2ban').checked;
            const ftp = document.getElementById('ftp').value;
            const quota = document.getElementById('quota').checked;
            const api = false; // Hestia API always disabled for VHestiaCP
            const interactive = document.getElementById('interactive').checked;

            let cmd = 'bash hst-install-ubuntu.sh';

            if (hostname) cmd += ` <span class="cmd-flag">-s</span> <span class="cmd-value">${hostname}</span>`;
            cmd += ` <span class="cmd-flag">-e</span> <span class="cmd-value">${email}</span>`;
            if (password) cmd += ` <span class="cmd-flag">-p</span> <span class="cmd-value">'${password}'</span>`;
            if (port !== '8083') cmd += ` <span class="cmd-flag">-r</span> <span class="cmd-value">${port}</span>`;
            if (lang !== 'en') cmd += ` <span class="cmd-flag">-l</span> <span class="cmd-value">${lang}</span>`;

            // Web Stack
            const needsHaproxy = webStack.startsWith('haproxy');
            const needsApache = webStack.includes('apache');

            if (webStack !== 'no-web') {
                cmd += ` <span class="cmd-flag">-a</span> <span class="cmd-value">${needsApache ? 'yes' : 'no'}</span>`;
            }
            cmd += ` <span class="cmd-flag">-w</span> <span class="cmd-value">${phpfpm ? 'yes' : 'no'}</span>`;

            if (needsHaproxy) {
                cmd += ` <span class="cmd-flag">--haproxy</span> <span class="cmd-value">yes</span>`;
                if (haproxyStats) cmd += ` <span class="cmd-flag">--haproxy-stats</span> <span class="cmd-value">yes</span>`;
            }

            // Runtime
            if (nodejs) {
                cmd += ` <span class="cmd-flag">--nodejs</span> <span class="cmd-value">yes</span>`;
                const versions = getCheckedVersions('nodejs-versions');
                if (versions.length) cmd += ` <span class="cmd-flag">--nodejs-versions</span> <span class="cmd-value">'${versions.join(',')}'</span>`;
            }
            if (python) cmd += ` <span class="cmd-flag">--python</span> <span class="cmd-value">yes</span>`;

            // Databases
            cmd += ` <span class="cmd-flag">-m</span> <span class="cmd-value">${mysql ? 'yes' : 'no'}</span>`;
            if (mysql8) cmd += ` <span class="cmd-flag">-M</span> <span class="cmd-value">yes</span>`;
            cmd += ` <span class="cmd-flag">-g</span> <span class="cmd-value">${postgresql ? 'yes' : 'no'}</span>`;

            if (mongodb) {
                cmd += ` <span class="cmd-flag">--mongodb</span> <span class="cmd-value">yes</span>`;
                cmd += ` <span class="cmd-flag">--mongodb-version</span> <span class="cmd-value">${mongodbVersion}</span>`;
            }

            // Message Queue
            if (rabbitmq) {
                cmd += ` <span class="cmd-flag">--rabbitmq</span> <span class="cmd-value">yes</span>`;
                if (document.getElementById('rabbitmq-management').checked) {
                    cmd += ` <span class="cmd-flag">--rabbitmq-management</span> <span class="cmd-value">yes</span>`;
                }
            }
            if (kafka) {
                cmd += ` <span class="cmd-flag">--kafka</span> <span class="cmd-value">yes</span>`;
                if (document.getElementById('kafka-ui').checked) {
                    cmd += ` <span class="cmd-flag">--kafka-ui</span> <span class="cmd-value">yes</span>`;
                }
            }
            if (redis) cmd += ` <span class="cmd-flag">--redis</span> <span class="cmd-value">yes</span>`;

            // DNS & Mail
            cmd += ` <span class="cmd-flag">-k</span> <span class="cmd-value">${named ? 'yes' : 'no'}</span>`;
            cmd += ` <span class="cmd-flag">-x</span> <span class="cmd-value">${exim ? 'yes' : 'no'}</span>`;
            if (exim) {
                cmd += ` <span class="cmd-flag">-z</span> <span class="cmd-value">${dovecot ? 'yes' : 'no'}</span>`;
                if (sieve) cmd += ` <span class="cmd-flag">-Z</span> <span class="cmd-value">yes</span>`;
                cmd += ` <span class="cmd-flag">-c</span> <span class="cmd-value">${clamav ? 'yes' : 'no'}</span>`;
                cmd += ` <span class="cmd-flag">-t</span> <span class="cmd-value">${spamassassin ? 'yes' : 'no'}</span>`;
            }

            // Security
            cmd += ` <span class="cmd-flag">-i</span> <span class="cmd-value">${iptables ? 'yes' : 'no'}</span>`;
            cmd += ` <span class="cmd-flag">-b</span> <span class="cmd-value">${fail2ban ? 'yes' : 'no'}</span>`;

            // FTP
            if (ftp === 'vsftpd') cmd += ` <span class="cmd-flag">-v</span> <span class="cmd-value">yes</span>`;
            else if (ftp === 'proftpd') cmd += ` <span class="cmd-flag">-j</span> <span class="cmd-value">yes</span>`;
            else cmd += ` <span class="cmd-flag">-v</span> <span class="cmd-value">no</span>`;

            if (quota) cmd += ` <span class="cmd-flag">-q</span> <span class="cmd-value">yes</span>`;
            cmd += ` <span class="cmd-flag">-d</span> <span class="cmd-value">${api ? 'yes' : 'no'}</span>`;
            if (!interactive) cmd += ` <span class="cmd-flag">-y</span> <span class="cmd-value">no</span>`;
            cmd += ` <span class="cmd-flag">-f</span>`;

            document.getElementById('command-output').innerHTML = cmd;
            updateStats();
        }

        function getCheckedVersions(containerId) {
            const container = document.getElementById(containerId);
            return Array.from(container.querySelectorAll('input:checked')).map(cb => cb.value);
        }

        function toggleCheckbox(label) {
            const cb = label.querySelector('input');
            cb.checked = !cb.checked;
            label.classList.toggle('checked', cb.checked);
            generateCommand();
        }

        function toggleNodejs() {
            // Node.js is always enabled for VHestiaCP
            document.getElementById('nodejs').checked = true;
            document.getElementById('nodejs-options').classList.remove('hidden');
            generateCommand();
        }

        function togglePython() {
            document.getElementById('python-options').classList.toggle('hidden', !document.getElementById('python').checked);
            generateCommand();
        }

        function toggleMongodb() {
            document.getElementById('mongodb-options').classList.toggle('hidden', !document.getElementById('mongodb').checked);
            updateMongodbWarning();
            generateCommand();
        }

        function updateMongodbWarning() {
            const version = document.getElementById('mongodb-version').value;
            const warning = document.getElementById('mongodb-warning');
            // Show warning for versions < 7.0 (not compatible with Ubuntu 24.04)
            if (parseFloat(version) < 7.0) {
                warning.style.display = 'block';
            } else {
                warning.style.display = 'none';
            }
        }

        function toggleRabbitmq() {
            document.getElementById('rabbitmq-options').classList.toggle('hidden', !document.getElementById('rabbitmq').checked);
            generateCommand();
        }

        function toggleKafka() {
            document.getElementById('kafka-options').classList.toggle('hidden', !document.getElementById('kafka').checked);
            generateCommand();
        }

        function toggleMysql() {
            if (!document.getElementById('mysql').checked) document.getElementById('mysql8').checked = false;
            generateCommand();
        }

        function toggleMysql8() {
            if (document.getElementById('mysql8').checked) document.getElementById('mysql').checked = true;
            generateCommand();
        }

        function toggleExim() {
            const exim = document.getElementById('exim').checked;
            ['dovecot-option', 'sieve-option', 'clamav-option', 'spamassassin-option'].forEach(id => {
                document.getElementById(id).classList.toggle('disabled', !exim);
            });
            generateCommand();
        }

        function updateWebStack() {
            const webStack = document.getElementById('web-stack').value;
            const needsHaproxy = webStack.startsWith('haproxy');
            document.getElementById('haproxy-options').classList.toggle('hidden', !needsHaproxy);
            generateCommand();
        }

        function updateStats() {
            let services = 0, newFeatures = 0;

            if (document.getElementById('web-stack').value.startsWith('haproxy')) { services++; newFeatures++; }
            if (document.getElementById('web-stack').value !== 'no-web') services++;
            if (document.getElementById('phpfpm').checked) services++;
            if (document.getElementById('nodejs').checked) { services++; newFeatures++; }
            if (document.getElementById('python').checked) { services++; newFeatures++; }
            if (document.getElementById('mysql').checked) services++;
            if (document.getElementById('postgresql').checked) services++;
            if (document.getElementById('mongodb').checked) { services++; newFeatures++; }
            if (document.getElementById('rabbitmq').checked) { services++; newFeatures++; }
            if (document.getElementById('kafka').checked) { services++; newFeatures++; }
            if (document.getElementById('redis').checked) { services++; newFeatures++; }
            if (document.getElementById('named').checked) services++;
            if (document.getElementById('exim').checked) services++;
            if (document.getElementById('dovecot').checked) services++;
            if (document.getElementById('ftp').value !== 'none') services++;

            let time = 10;
            if (document.getElementById('clamav').checked) time += 5;
            if (document.getElementById('mongodb').checked) time += 3;
            if (document.getElementById('nodejs').checked) time += 2;
            if (document.getElementById('python').checked) time += 2;
            if (document.getElementById('rabbitmq').checked) time += 2;
            if (document.getElementById('kafka').checked) time += 3;

            document.getElementById('stat-services').textContent = services;
            document.getElementById('stat-new').textContent = newFeatures;
            document.getElementById('stat-time').textContent = `~${time}`;
        }

        function copyCommand() {
            const cmd = document.getElementById('command-output').innerText;
            copyToClipboard(cmd, document.querySelector('.command-box-header .copy-btn'));
        }

        function copyToClipboard(text, btn) {
            navigator.clipboard.writeText(text).then(() => {
                const orig = btn.textContent;
                btn.textContent = '✓';
                btn.classList.add('copied');
                setTimeout(() => { btn.textContent = orig; btn.classList.remove('copied'); }, 1500);
            });
        }

        function resetOptions() {
            document.getElementById('hostname').value = '';
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
            document.getElementById('port').value = '8083';
            document.getElementById('lang').value = 'en';
            document.getElementById('web-stack').value = 'haproxy-nginx';
            document.getElementById('phpfpm').checked = false; // PHP optional
            document.getElementById('haproxy-stats').checked = true;
            document.getElementById('nodejs').checked = true; // Always enabled
            document.getElementById('nodejs-options').classList.remove('hidden'); // Always visible
            document.getElementById('python').checked = false;
            document.getElementById('python-options').classList.add('hidden');
            document.getElementById('mysql').checked = true;
            document.getElementById('mysql8').checked = false;
            document.getElementById('postgresql').checked = false;
            document.getElementById('mongodb').checked = false;
            document.getElementById('mongodb-options').classList.add('hidden');
            document.getElementById('rabbitmq').checked = false;
            document.getElementById('rabbitmq-options').classList.add('hidden');
            document.getElementById('kafka').checked = false;
            document.getElementById('kafka-options').classList.add('hidden');
            document.getElementById('redis').checked = false;
            document.getElementById('named').checked = true;
            document.getElementById('exim').checked = true;
            document.getElementById('dovecot').checked = true;
            document.getElementById('sieve').checked = false;
            document.getElementById('clamav').checked = true;
            document.getElementById('spamassassin').checked = true;
            document.getElementById('iptables').checked = true;
            document.getElementById('fail2ban').checked = true;
            document.getElementById('ftp').value = 'vsftpd';
            document.getElementById('quota').checked = false;
            // api is always disabled (hidden input)
            document.getElementById('interactive').checked = false;

            document.querySelectorAll('.checkbox-item').forEach(item => {
                const cb = item.querySelector('input');
                const isDefault = cb.hasAttribute('checked');
                cb.checked = isDefault;
                item.classList.toggle('checked', isDefault);
            });

            updateWebStack();
            generateCommand();
        }
    </script>
</body>
</html>
